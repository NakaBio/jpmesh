<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use mesh cord in R • jpmesh</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="How to use mesh cord in R">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">jpmesh</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/articles/plots.html">Construct maps with jpmesh</a>
    </li>
    <li>
      <a href="../articles/usage.html">How to use mesh cord in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/uribo/jpmesh">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>How to use mesh cord in R</h1>
                        <h4 class="author">Shinya Uryu</h4>
            
            <h4 class="date">2018-02-28</h4>
          </div>

    
    
<div class="contents">
<div class="section level2">
<h2>概要</h2>
<p><strong>jpmesh</strong>パッケージは、日本国内で利用される「地域メッシュ（メッシュコード）」をRから容易に利用可能にするパッケージです。地域メッシュとは、日本国土を緯度・経度により方形の小地域区画に細分することで、同一の基準による統計調査などの結果を得ることが可能となります。80kmから125mまでのメッシュコードに対応し、メッシュコードと緯度経度座標との相互変換を行います。</p>
<p><strong>jpmesh</strong>の主な機能として、「緯度経度からの地域メッシュへの変換」、「地域メッシュからの緯度経度の取得」、「都道府県単位やleaflet上へのマッピング」があります。なお地域メッシュと緯度経度の変換の基礎は<a href="http://takenaka-akio.org/etc/meshcode/r_code.html">竹中明夫さんのRコード</a>が基礎となっています。ここではその使い方を紹介します。</p>
<p>パッケージをインストールしたら環境内で利用可能にするため、読み込みを行いましょう。また、このサンプルページで用いるパッケージも同時に読み込むようにしておきます。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(jpmesh)
<span class="kw">library</span>(sf)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(purrr)</code></pre></div>
<div class="section level4">
<h4>緯度経度と地域メッシュの相互変換</h4>
<p><code><a href="../reference/mesh_to_coords.html">mesh_to_coords()</a></code>関数を利用し、緯度経度から地域メッシュを得ることができます。この関数では11桁までの細分地域メッシュに対応し、メッシュの中心座標とメッシュの範囲を示す値を返します。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mesh_to_coords.html">mesh_to_coords</a></span>(<span class="dv">5133</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   lng_center lat_center lng_error lat_error
##        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1       134.       34.3     0.500     0.333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mesh_to_coords.html">mesh_to_coords</a></span>(<span class="dv">513377</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   lng_center lat_center lng_error lat_error
##        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1       134.       34.6    0.0625    0.0417</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mesh_to_coords.html">mesh_to_coords</a></span>(<span class="dv">51337783</span>)</code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   lng_center lat_center lng_error lat_error
##        &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1       134.       34.7   0.00625   0.00417</code></pre>
<p>得られるメッシュの領域データを使ってメッシュのポリゴンを作成する例です。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/export_mesh.html">export_mesh</a></span>(<span class="dv">5133778311</span>)</code></pre></div>
<pre><code>## Geometry set for 1 feature 
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 133.9125 ymin: 34.65 xmax: 133.9156 ymax: 34.65208
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre><code>## POLYGON ((133.9125 34.65, 133.9156 34.65, 133.9...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/mesh_to_coords.html">mesh_to_coords</a></span>(<span class="dv">5133778311</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">geometry =</span> purrr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map2">pmap_chr</a></span>(., <span class="op">~</span><span class="st"> </span>jpmesh<span class="op">:::</span><span class="kw">mesh_to_poly</span>(...))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(geometry)</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   geometry                                                                
##   &lt;chr&gt;                                                                   
## 1 POLYGON ((133.9125 34.65, 133.9156 34.65, 133.9156 34.65208, 133.9125 3…</code></pre>
<p>緯度経度から地域メッシュを得ることもできます。これには<code><a href="../reference/coords_to_mesh.html">coords_to_mesh()</a></code>を利用します。引数に緯度と経度を与え、取得対象のメッシュコードの大きさを指定します。メッシュコードの大きさの初期値は標準地域メッシュ、すなわち1kmメッシュです。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>)</code></pre></div>
<pre><code>## [1] "51330000"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>, <span class="dt">mesh_size =</span> <span class="st">"80km"</span>)</code></pre></div>
<pre><code>## [1] "5133"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>, <span class="dt">mesh_size =</span> <span class="st">"125m"</span>)</code></pre></div>
<pre><code>## [1] "51330000111"</code></pre>
<p>また対象の地域メッシュ内に含まれる緯度経度からスケールダウンした地域メッシュや、隣接するメッシュコードを得ることができます。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 80kmメッシュに含まれる10kmメッシュを返します</span>
<span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>, <span class="st">"80km"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/fine_separate.html">fine_separate</a></span>()</code></pre></div>
<pre><code>##  [1] "513300" "513301" "513302" "513303" "513304" "513305" "513306"
##  [8] "513307" "513310" "513311" "513312" "513313" "513314" "513315"
## [15] "513316" "513317" "513320" "513321" "513322" "513323" "513324"
## [22] "513325" "513326" "513327" "513330" "513331" "513332" "513333"
## [29] "513334" "513335" "513336" "513337" "513340" "513341" "513342"
## [36] "513343" "513344" "513345" "513346" "513347" "513350" "513351"
## [43] "513352" "513353" "513354" "513355" "513356" "513357" "513360"
## [50] "513361" "513362" "513363" "513364" "513365" "513366" "513367"
## [57] "513370" "513371" "513372" "513373" "513374" "513375" "513376"
## [64] "513377"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隣接するメッシュコードを同じスケールで返します</span>
<span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>, <span class="st">"80km"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/neighbor_mesh.html">neighbor_mesh</a></span>()</code></pre></div>
<pre><code>## [1] "5032" "5033" "5034" "5132" "5133" "5134" "5232" "5233" "5234"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/coords_to_mesh.html">coords_to_mesh</a></span>(<span class="dv">133</span>, <span class="dv">34</span>, <span class="st">"500m"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/neighbor_mesh.html">neighbor_mesh</a></span>()</code></pre></div>
<pre><code>## [1] "503277994" "503370903" "503370904" "513207092" "513207094" "513300003"
## [7] "513300004" "513300001"</code></pre>
</div>
<div class="section level4">
<h4>都道府県単位での基準地域メッシュの描画</h4>
<p><strong>jpmesh</strong>では、都道府県および市区町村名を含んだ基準地域メッシュのデータセットを用意しています。これを利用することで、都道府県や市区町村単位での地域メッシュを扱うことができます。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/administration_mesh.html">administration_mesh</a></span>(<span class="dt">code =</span> <span class="dv">33</span>, <span class="dt">type =</span> <span class="st">"prefecture"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">head</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="dt">format =</span> <span class="st">"markdown"</span>)</code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="7%">
<col width="64%">
</colgroup>
<thead><tr class="header">
<th align="left">meshcode</th>
<th align="right">lng_center</th>
<th align="right">lat_center</th>
<th align="right">lng_error</th>
<th align="right">lat_error</th>
<th align="left">geometry</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">513376</td>
<td align="right">133.8125</td>
<td align="right">34.62500</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.75, 133.875, 133.875, 133.75, 133.75, 34.58333, 34.58333, 34.66667, 34.66667, 34.58333))</td>
</tr>
<tr class="even">
<td align="left">513377</td>
<td align="right">133.9375</td>
<td align="right">34.62500</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.875, 134, 134, 133.875, 133.875, 34.58333, 34.58333, 34.66667, 34.66667, 34.58333))</td>
</tr>
<tr class="odd">
<td align="left">523305</td>
<td align="right">133.6875</td>
<td align="right">34.70833</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.625, 133.75, 133.75, 133.625, 133.625, 34.66667, 34.66667, 34.75, 34.75, 34.66667))</td>
</tr>
<tr class="even">
<td align="left">523306</td>
<td align="right">133.8125</td>
<td align="right">34.70833</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.75, 133.875, 133.875, 133.75, 133.75, 34.66667, 34.66667, 34.75, 34.75, 34.66667))</td>
</tr>
<tr class="odd">
<td align="left">523307</td>
<td align="right">133.9375</td>
<td align="right">34.70833</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.875, 134, 134, 133.875, 133.875, 34.66667, 34.66667, 34.75, 34.75, 34.66667))</td>
</tr>
<tr class="even">
<td align="left">523315</td>
<td align="right">133.6875</td>
<td align="right">34.79167</td>
<td align="right">0.0625</td>
<td align="right">0.0416667</td>
<td align="left">list(c(133.625, 133.75, 133.75, 133.625, 133.625, 34.75, 34.75, 34.83333, 34.83333, 34.75))</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="session-information" class="section level2">
<h2 class="hasAnchor">
<a href="#session-information" class="anchor"></a>Session Information</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()</code></pre></div>
<pre><code>## R version 3.4.3 (2017-11-30)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Debian GNU/Linux 9 (stretch)
## 
## Matrix products: default
## BLAS: /usr/lib/openblas-base/libblas.so.3
## LAPACK: /usr/lib/libopenblasp-r0.2.19.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=C             
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] bindrcpp_0.2      purrr_0.2.4       dplyr_0.7.4       sf_0.6-0         
## [5] jpmesh_1.1.0.9000
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.15           highr_0.6              pillar_1.2.1          
##  [4] compiler_3.4.3         bindr_0.1              prettyunits_1.0.2     
##  [7] progress_1.1.2.9002    class_7.3-14           tools_3.4.3           
## [10] digest_0.6.15          evaluate_0.10.1        tibble_1.4.2          
## [13] pkgconfig_2.0.1        rlang_0.2.0.9000       cli_1.0.0.9001        
## [16] shiny_1.0.5            DBI_0.7                crosstalk_1.0.0       
## [19] yaml_2.1.17            e1071_1.6-8            withr_2.1.1.9000      
## [22] xml2_1.2.0             stringr_1.3.0          knitr_1.20            
## [25] hms_0.4.1              htmlwidgets_1.0        tidyselect_0.2.4      
## [28] classInt_0.1-24        rprojroot_1.3-2        leaflet_1.1.0         
## [31] grid_3.4.3             glue_1.2.0             R6_2.2.2              
## [34] rmarkdown_1.8          selectr_0.3-1          tidyr_0.8.0           
## [37] udunits2_0.13          magrittr_1.5           ansistrings_1.0.0.9000
## [40] backports_1.1.2        htmltools_0.3.6        units_0.5-1           
## [43] assertthat_0.2.0       mime_0.5               xtable_1.8-2          
## [46] httpuv_1.3.5           utf8_1.1.3             stringi_1.1.6         
## [49] miniUI_0.1.1           crayon_1.3.4</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="NA">概要</a></li>
      <li><a href="#session-information">Session Information</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Shinya Uryu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
